[supervisord]
nodaemon=true

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock
chmod=0777

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0777

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:mysql]
command=/usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib/mysql/plugin --user=user --port=3307 --bind-address=0.0.0.0
autostart=true
stdout_logfile=/var/log/mysql.log
stderr_logfile=/var/log/mysql_error.log

[program:redis]
command=/usr/bin/redis-server
autostart=true
stdout_logfile=/var/log/redis.log
stderr_logfile=/var/log/redis_error.log

[program:rabbitmq]
command=/usr/sbin/rabbitmq-server
autostart=true
stdout_logfile=/var/log/rabbitmq.log
stderr_logfile=/var/log/rabbitmq_error.log

[program:provision]
command=/opt/scripts/provisioning/provision.sh
autostart=false
startretries=0
stdout_logfile=/var/log/provision.log
stderr_logfile=/var/log/provision_error.log

[program:backend]
command=/opt/scripts/provisioning/project/run-backend.sh
autostart=false
stdout_logfile=/var/log/backend.log
stderr_logfile=/var/log/backend_error.log

[program:worker]
command=/opt/scripts/provision/project/run-worker.sh
autostart=false
stdout_logfile=/var/log/worker.log
stderr_logfile=/var/log/worker_error.log

[eventlistener:provision_listener]
command=/bin/bash -c 'supervisorctl start backend worker'
events=PROCESS_STATE_EXITED
process_name=provision
